<html>
  <head>
    <title>CoffeeScript compiler in the browser</title>
    <script type="text/javascript" src="coffeepot-min.js"></script>
    <script type="text/coffeescript">
      # Compile the contents of the code box and show all output
      compile: =>

        # Get data from the form element
        form: document.getElementById("form")
        code: form.code.value

        # Do a three step compile
        tokens: CoffeePot.tokenize(code)
        tree: CoffeePot.parse(tokens)
        js: CoffeePot.generate(tree)

        # Put the result back in the form
        form.tokens.value = JSON.stringify(tokens)
        form.tree.value = JSON.stringify(tree)
        form.js.value = js

      # Compile on page load
      this.compile = compile
      window.onload = compile
    </script>
    <script type="text/javascript">
      (function () {
        var compile;

        // Compile the contents of the code box and show all output
        compile = function compile() {
          var form, code, tokens, tree, js;

          // Get data from the form element
          form = document.getElementById("form");
          code = form.code.value;

          // Do a three step compile
          tokens = CoffeePot.tokenize(code);
          tree = CoffeePot.parse(tokens);
          js = CoffeePot.generate(tree);

          // Put the result back in the form
          form.tokens.value = JSON.stringify(tokens);
          form.tree.value = JSON.stringify(tree);
          form.js.value = js;
        };

        // Compile on page load
        this.compile = compile;
        window.onload = compile;
      }());
    </script>
    <style type="text/css">
      label {
        display: block;
        font-size: 24px;
        font-family: monaco;
      }
      textarea {
        font-family: monaco;
        font-size: 16px;
        height: 300px;
        width: 100%;

      }
      table {
        width: 100%;
      }
      #go {
        display:block;
        width: 200px;
        font-weight: bold;
        margin: 10px auto;
        border: 1px solid #000;
      }
    </style>
  </head>
  <body>
    <h1>CoffeePot - A CoffeeScript compiler written in CoffeeScript</h1>
    <p><a href="http://jashkenas.github.com/coffee-script/">CoffeeScript</a> is a really neat language made by Jeremy Ashkenas.
      The only problem is that compiler itself is written in ruby.  So for fun I decided to write a compiler in CoffeeScript itself.
      Since the language compiles to javascript we're able to test the compiler live in a regular static html page.
      Have fun!.
    </p>
    <p>See the source code at my <a href="http://github.com/creationix/coffeepot">github</a>.</p>
    <form id="form" onsubmit="compile();return false;">
      <table><tr><td>
        <label for="code">CoffeeScript Code</label>
        <textarea onkeyup="compile()" id="code" name="code"># Assignment:
number: 42
opposite_day: true

# Conditions:
number: -42 if opposite_day

# Functions:
square: x => x * x

# Arrays:
list: [1, 2, 3, 4, 5]

# Objects:
math: {
  root:   Math.sqrt
  square: square
  cube:   x => x * square(x)
}
</textarea>
      </td><td>
        <label for="js">JavaScript Output</label>
        <textarea readonly="readonly" id="js" name="js"></textarea>
      </td></tr><tr><td colspan="2">
        <input id="go" type="submit" value="Compile!" />
      </td></tr><tr><td>
        <label for="tokens">Tokens</label>
        <textarea readonly="readonly" id="tokens" name="tokens"></textarea>
      </td><td>
        <label for="tree">Abstract Syntax Tree</label>
        <textarea readonly="readonly" id="tree" name="tree"></textarea>
      </td></tr></table>
    </form>
  </body>
</html>